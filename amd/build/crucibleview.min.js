define(["jquery"],function($){var timeout;return{init:function(){("Active"==status?show_active:""==status?show_ended:show_wait)(),function run_loop(){timeout=setTimeout(function(){check_status(),run_loop(),"Ended"==status&&console.log("lab has ended")},5e3)}(),$(window).on("resize",function(){console.log("window resized")})}};function check_status(){id?(console.log("implementation id "+id),jQuery.ajax({url:alloy_api_url+"/implementations/"+id,type:"GET",contentType:"application/json",dataType:"json",beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+access_token)},success:function(response){$.each(response,function(index,value){"exerciseId"==index&&value&&(exerciseid=value,console.log("exerciseid "+exerciseid)),"status"==index&&(console.log("status "+status),"Active"==value&&(show_active(),clearTimeout(timeout)),"Creating"!=value&&"Planning"!=value&&"Applying"!=value&&"Ending"!=value||show_wait(),"Ended"==value&&(show_ended(),clearTimeout(timeout)),"Failed"==value&&(document.getElementById("launch_button").style.display="none",document.getElementById("end_button").style.display="none",document.getElementById("wait").style.display="none",document.getElementById("vm_or_link").style.display="none",document.getElementById("failed").style.display="block",clearTimeout(timeout)),status=value)})},error:function(response){"401"==response.status&&(console.log("permission error, check token"),clearTimeout(timeout))}})):show_ended()}function show_wait(){document.getElementById("launch_button").style.display="none",document.getElementById("end_button").style.display="none",document.getElementById("wait").style.display="block",document.getElementById("vm_or_link").style.display="none",document.getElementById("failed").style.display="none"}function show_ended(){document.getElementById("launch_button").style.display="block",document.getElementById("end_button").style.display="none",document.getElementById("wait").style.display="none",document.getElementById("vm_or_link").style.display="none",document.getElementById("failed").style.display="none"}function show_active(){var x;(x=document.getElementById("launch_button")).style.display="none",(x=document.getElementById("end_button")).style.display="block",(x=document.getElementById("implementation")).style.value=id,(x=document.getElementById("wait")).style.display="none",(x=document.getElementById("vm_or_link")).setAttribute("src",vm_app_url+"/exercises/"+exerciseid),x.style.display="block",(x=document.getElementById("vm_or_link")).setAttribute("href",player_app_url+"/exercise-player/"+exerciseid),x.style.display="block",(x=document.getElementById("failed")).style.display="none"}});