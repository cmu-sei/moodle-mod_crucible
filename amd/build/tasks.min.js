define("mod_crucible/tasks",["jquery","core/config","core/log"],(function($,config,log){var scenario_id,attempt,cmid;return{init:function(info){console.log("scenario id "+info.scenario),scenario_id=info.scenario,attempt=info.attempt,cmid=info.cmid,get_results(),setInterval((function(){get_results()}),5e3);var tasks=document.getElementsByClassName("exec-task");$.each(tasks,(function(index,value){var id=value.id,button=document.getElementById(id);button&&"Run Task"===button.innerHTML&&(button.onclick=function(){!function(id){console.log("exec task for "+id),$.ajax({url:config.wwwroot+"/mod/crucible/runtask.php",dataType:"json",type:"POST",data:{sesskey:config.sesskey,time:$.now(),id:id,a:attempt,cmid:cmid},headers:{"Cache-Control":"no-cache",Expires:"-1"},success:function(response){console.log(response)},error:function(request){console.log("crucible task failed"),console.log(request),log.debug("moodle-mod_crucible-runtask: ".request)}})}(id)},console.log("set event for button "+id))}))}};function get_results(){$.ajax({url:config.wwwroot+"/mod/crucible/getresults.php",dataType:"json",type:"POST",data:{sesskey:config.sesskey,time:$.now(),id:scenario_id,cmid:cmid,a:attempt},headers:{"Cache-Control":"no-cache",Expires:"-1"},success:function(response){console.log(response),index=0,$.each(response.parsed,(function(index,value){var result=document.getElementById("result-"+value.taskId);result&&value.status&&(result.innerHTML=value.status);var score=document.getElementById("score-"+value.taskId);score&&null!=typeof value.score&&(score.innerHTML=value.score)}));var score=document.getElementById("attempt-score");score&&(score.innerHTML=response.score)},error:function(response){console.log("error"),console.log(response)}})}}));

//# sourceMappingURL=tasks.min.js.map