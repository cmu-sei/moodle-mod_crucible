define(["jquery","core/config","core/log"],function(a,b,c){function d(){a.ajax({url:b.wwwroot+"/mod/crucible/getresults.php",dataType:"json",type:"POST",data:{sesskey:b.sesskey,time:a.now(),id:g},headers:{"Cache-Control":"no-cache",Expires:"-1"},success:function(b){console.log(b),b.parsed.sort(function(a,b){return a.statusDate>b.statusDate?1:-1}),a.each(b.parsed,function(a,b){var c=document.getElementById("result-"+b.dispatchTaskId);c&&(c.innerHTML=b.status)})},error:function(a){console.log("error"),console.log(a),clearTimeout(f)}})}function e(d){console.log("exec task for "+d),a.ajax({url:b.wwwroot+"/mod/crucible/runcustomtask.php",dataType:"json",type:"POST",data:{sesskey:b.sesskey,time:a.now(),id:d},headers:{"Cache-Control":"no-cache",Expires:"-1"},success:function(a){console.log(a)},error:function(a){console.log("crucible task failed"),console.log(a),c.debug("moodle-mod_crucible-runtask: ".request)}})}var f,g;return{init:function(b){g=b.exercise,d(),f=setInterval(function(){d()},5e3);var c=document.getElementsByClassName("exec-task");a.each(c,function(a,b){var c=b.id,d=document.getElementById(c);d&&"Run Task"===d.innerHTML&&(d.onclick=function(){e(c)},console.log("set event for button "+c))})}}});
