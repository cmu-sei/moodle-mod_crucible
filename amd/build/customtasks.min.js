define("mod_crucible/customtasks",["jquery","core/config","core/log"],(function($,config,log){var timeout,view_id;return{init:function(info){view_id=info.view,get_results(),timeout=setInterval((function(){get_results()}),5e3);var tasks=document.getElementsByClassName("exec-task");$.each(tasks,(function(index,value){var id=value.id,button=document.getElementById(id);button&&"Run Task"===button.innerHTML&&(button.onclick=function(){!function(id){console.log("exec task for "+id),$.ajax({url:config.wwwroot+"/mod/crucible/runcustomtask.php",dataType:"json",type:"POST",data:{sesskey:config.sesskey,time:$.now(),id:id},headers:{"Cache-Control":"no-cache",Expires:"-1"},success:function(result){console.log(result)},error:function(request){console.log("crucible task failed"),console.log(request),log.debug("moodle-mod_crucible-runtask: ".request)}})}(id)},console.log("set event for button "+id))}))}};function get_results(){$.ajax({url:config.wwwroot+"/mod/crucible/getresults.php",dataType:"json",type:"POST",data:{sesskey:config.sesskey,time:$.now(),id:view_id},headers:{"Cache-Control":"no-cache",Expires:"-1"},success:function(response){console.log(response),response.parsed.sort((function(a,b){return a.statusDate>b.statusDate?1:-1})),$.each(response.parsed,(function(index,value){var result=document.getElementById("result-"+value.taskId);result&&(result.innerHTML=value.status)}))},error:function(response){console.log("error"),console.log(response),clearTimeout(timeout)}})}}));

//# sourceMappingURL=customtasks.min.js.map