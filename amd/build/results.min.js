define(["jquery"],function(a){function b(){a.ajax({url:f+"/sessions/"+e+"/dispatchtaskresults",type:"GET",contentType:"application/json",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+d)},success:function(b){b.sort(function(a,b){return a.statusDate>b.statusDate?1:-1}),a.each(b,function(a,b){var c=document.getElementById("result-"+b.dispatchTaskId);c&&(c.innerHTML=b.status)})},error:function(a){"401"==a.status&&(console.log("permission error, check token"),clearTimeout(g))}})}function c(b){console.log("exec task for "+b),a.ajax({url:f+"/dispatchtasks/"+b+"/execute",type:"POST",contentType:"application/json",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+d)},success:function(b){console.log(b),a.each(b,function(a,b){console.log("index "+a),console.log("value "+b)})},error:function(a){"401"==a.status?console.log("permission error, check token"):"400"==a.status&&(console.log(a.responseJSON),alert("Run Task command failed "+a.responseJSON.detail))}})}var d,e,f,g;return{init:function(h,i,j){console.log("session id "+i),d=h,e=i,f=j,g=setInterval(function(){b()},5e3);var k=document.getElementsByClassName("exec-task");a.each(k,function(a,b){var d=b.id,e=document.getElementById(d);e&&"Run Task"===e.innerHTML&&(e.onclick=function(){c(d)}),console.log("set event for button "+d)})}}});