define ("mod_crucible/results",["jquery"],function(a){var d,e,f,g;return{init:function init(h){console.log("scenario id "+h.scenario);d=h.token;e=h.scenario;f=h.steamfitter_api;b();g=setInterval(function(){b()},5e3);var i=document.getElementsByClassName("exec-task");a.each(i,function(a,b){var d=b.id,e=document.getElementById(d);if(e){if("Run Task"===e.innerHTML){e.onclick=function(){c(d);console.log("set event for button "+d)}}}})}};function b(){a.ajax({url:f+"/scenarios/"+e+"/results",type:"GET",contentType:"application/json",dataType:"json",beforeSend:function beforeSend(a){a.setRequestHeader("Authorization","Bearer "+d)},success:function success(b){b.sort(function(c,a){return c.statusDate>a.statusDate?1:-1});a.each(b,function(a,b){var c=document.getElementById("result-"+b.taskId);if(c){c.innerHTML=b.status}})},error:function error(a){if("401"==a.status){console.log("permission error, check token, reload page");alert("permission error, check token, reload page");clearTimeout(g)}else{console.log(a);clearTimeout(g)}}})}function c(b){console.log("exec task for "+b);a.ajax({url:f+"/tasks/"+b+"/execute",type:"POST",contentType:"application/json",dataType:"json",beforeSend:function beforeSend(a){a.setRequestHeader("Authorization","Bearer "+d)},success:function success(b){a.each(b,function(a,b){console.log(b.statusDate+" task "+b.taskId+" status "+b.status);var c=document.getElementById("result-"+b.taskId);if(c){c.innerHTML=b.status}})},error:function error(a){if("401"==a.status){console.log("permission error, check token, reload page");alert("permission error, check token, reload page")}else if("400"==a.status){console.log(a.responseJSON);alert("Run Task command failed "+a.responseJSON.detail)}else if("500"==a.status){console.log(a.responseJSON);alert("Run Task command failed "+a.responseJSON.detail)}}})}});
//# sourceMappingURL=results.min.js.map
