define("mod_crucible/results",["jquery"],(function($){var access_token,scenario_id,steamfitter_api_url,timeout;return{init:function(info){console.log("scenario id "+info.scenario),access_token=info.token,scenario_id=info.scenario,steamfitter_api_url=info.steamfitter_api,get_results(),timeout=setInterval((function(){get_results()}),5e3);var tasks=document.getElementsByClassName("exec-task");$.each(tasks,(function(index,value){var id=value.id,button=document.getElementById(id);button&&"Run Task"===button.innerHTML&&(button.onclick=function(){!function(id){console.log("exec task for "+id),$.ajax({url:steamfitter_api_url+"/tasks/"+id+"/execute",type:"POST",contentType:"application/json",dataType:"json",beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+access_token)},success:function(response){$.each(response,(function(index,value){console.log(value.statusDate+" task "+value.taskId+" status "+value.status);var result=document.getElementById("result-"+value.taskId);result&&(result.innerHTML=value.status)}))},error:function(response){"401"==response.status?(console.log("permission error, check token, reload page"),alert("permission error, check token, reload page")):("400"==response.status||"500"==response.status)&&(console.log(response.responseJSON),alert("Run Task command failed "+response.responseJSON.detail))}})}(id),console.log("set event for button "+id)})}))}};function get_results(){$.ajax({url:steamfitter_api_url+"/scenarios/"+scenario_id+"/results",type:"GET",contentType:"application/json",dataType:"json",beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+access_token)},success:function(response){response.sort((function(a,b){return a.statusDate>b.statusDate?1:-1})),$.each(response,(function(index,value){var result=document.getElementById("result-"+value.taskId);result&&(result.innerHTML=value.status)}))},error:function(response){"401"==response.status?(console.log("permission error, check token, reload page"),alert("permission error, check token, reload page"),clearTimeout(timeout)):(console.log(response),clearTimeout(timeout))}})}}));

//# sourceMappingURL=results.min.js.map