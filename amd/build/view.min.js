define("mod_crucible/view",["jquery"],(function($){var timeout,access_token,lab_status,event_id,view_id,alloy_api_url,vm_app_url,player_app_url;return{init:function(){const config=window.CrucibleConfig||{};access_token=config.token,lab_status=config.state,event_id=config.event,view_id=config.view,alloy_api_url=config.alloy_api_url,vm_app_url=config.vm_app_url,player_app_url=config.player_app_url,"Active"==lab_status?function(){editStyle("launch_button","display","none"),editStyle("end_button","display","inline"),editStyle("event","value",event_id),editStyle("wait","display","none"),editStyle("failed","display","none"),editStyle("timerdiv","display","inline"),editStyle("crucible-container","display","block"),editStyle("enable-fullscreen","display","inline"),editStyle("invite_button","display","block"),editStyle("return-button","display","block"),editStyle("join-form","display","block");var x=document.getElementById("vm_or_link");x&&(null!==x.getAttribute("src")&&x.setAttribute("src",vm_app_url+"/views/"+view_id),x.getAttribute("href")&&x.setAttribute("href",player_app_url+"/view/"+view_id),x.style.display="block")}():""==lab_status?show_ended():show_wait();var button=document.getElementById("enable-fullscreen");button&&(button.onclick=function(){document.getElementById("vm_or_link").requestFullscreen()}),run_loop()}};function check_status(){event_id?(console.log("event id "+event_id),$.ajax({url:alloy_api_url+"/events/"+event_id,type:"GET",contentType:"application/json",dataType:"json",beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+access_token)},success:function(response){$.each(response,(function(index,value){"viewId"==index&&value&&(view_id=value,console.log("view_id "+view_id)),"status"==index&&(console.log("status "+lab_status),"Active"==value&&"Active"!=lab_status&&"Active"==value&&(console.log("reloading"),window.location.replace(window.location.href)),"Creating"!=value&&"Planning"!=value&&"Applying"!=value&&"Ending"!=value||show_wait(),"Ended"==value&&(show_ended(),window.location.replace(window.location.href)),"Failed"==value&&(editStyle("launch_button","display","none"),editStyle("end_button","display","none"),editStyle("wait","display","none"),editStyle("vm_or_link","display","none"),editStyle("failed","display","block"),editStyle("crucible-container","display","none"),editStyle("enable-fullscreen","display","none"),editStyle("invite_button","display","none"),editStyle("return-button","display","none"),editStyle("join-form","display","none")),lab_status=value),"scenarioid"==index&&console.log("scenario id "+value)}))},error:function(response){"401"==response.status&&(console.log("permission error, check token"),clearTimeout(timeout),window.location.replace(window.location.href))}})):show_ended()}function show_wait(){editStyle("launch_button","display","none"),editStyle("end_button","display","none"),editStyle("wait","display","block"),editStyle("vm_or_link","display","none"),editStyle("failed","display","none"),editStyle("crucible-container","display","none"),editStyle("enable-fullscreen","display","none"),editStyle("enable-fullscreen","display","none"),editStyle("invite_button","display","none"),editStyle("return-button","display","block"),editStyle("join-form","display","block")}function show_ended(){editStyle("launch_button","display","block"),editStyle("end_button","display","none"),editStyle("wait","display","none"),editStyle("vm_or_link","display","none"),editStyle("failed","display","none"),editStyle("timerdiv","display","none"),editStyle("crucible-container","display","none"),editStyle("enable-fullscreen","display","none"),editStyle("invite_button","display","none"),editStyle("return-button","display","block"),editStyle("join-form","display","block")}function editStyle(elementId,styleName,styleValue){var x=document.getElementById(elementId);x&&(x.style[styleName]=styleValue)}function run_loop(){timeout=setTimeout((function(){check_status(),run_loop()}),5e3)}}));

//# sourceMappingURL=view.min.js.map