define ("mod_crucible/view",["jquery"],function(a){var i,j,k,l,m,n,o,p;return{init:function init(a){j=a.token;k=a.state;l=a.event;m=a.view;n=a.alloy_api_url;o=a.vm_app_url;p=a.player_app_url;if("Active"==k){f()}else if(""==k){d()}else{c()}var b=document.getElementById("enable-fullscreen");if(b){b.onclick=function(){var a=document.getElementById("vm_or_link");a.requestFullscreen()}}h()}};function b(){if(l){console.log("event id "+l);a.ajax({url:n+"/events/"+l,type:"GET",contentType:"application/json",dataType:"json",beforeSend:function beforeSend(a){a.setRequestHeader("Authorization","Bearer "+j)},success:function success(b){a.each(b,function(a,b){if("viewId"==a){if(b){m=b;console.log("view_id "+m)}}if("status"==a){console.log("status "+k);if("Active"==b){clearTimeout(i);if("Active"!=k&&"Active"==b){console.log("reloading");window.location.replace(window.location.href)}}if("Creating"==b||"Planning"==b||"Applying"==b||"Ending"==b){c()}if("Ended"==b){window.location.replace(window.location.href)}if("Failed"==b){e();clearTimeout(i)}k=b}if("scenarioid"==a){console.log("scenario id "+b)}})},error:function error(a){if("401"==a.status){console.log("permission error, check token");clearTimeout(i);window.location.replace(window.location.href)}}})}else{d()}}function c(){g("launch_button","display","none");g("end_button","display","none");g("wait","display","block");g("vm_or_link","display","none");g("failed","display","none");g("crucible-container","display","none");g("enable-fullscreen","display","none");g("enable-fullscreen","display","none");g("invite_button","display","none");g("return-button","display","none");g("join-form","display","none")}function d(){g("launch_button","display","block");g("end_button","display","none");g("wait","display","none");g("vm_or_link","display","none");g("failed","display","none");g("timerdiv","display","none");g("crucible-container","display","none");g("enable-fullscreen","display","none");g("invite_button","display","none");g("return-button","display","block");g("join-form","display","block")}function e(){g("launch_button","display","none");g("end_button","display","none");g("wait","display","none");g("vm_or_link","display","none");g("failed","display","block");g("crucible-container","display","none");g("enable-fullscreen","display","none");g("invite_button","display","none");g("return-button","display","none");g("join-form","display","none")}function f(){g("launch_button","display","none");g("end_button","display","block");g("event","value",l);g("wait","display","none");g("failed","display","none");g("timerdiv","display","block");g("crucible-container","display","block");g("enable-fullscreen","display","inline-block");g("invite_button","display","block");g("return-button","display","block");g("join-form","display","block");var a=document.getElementById("vm_or_link");if(a){if(null!==a.getAttribute("src")){a.setAttribute("src",o+"/views/"+m)}if(a.getAttribute("href")){a.setAttribute("href",p+"/view/"+m)}a.style.display="block"}}function g(a,b,c){var d=document.getElementById(a);if(d){d.style[b]=c}}function h(){i=setTimeout(function(){b();h();if("Ended"==k){console.log("lab has ended")}},5e3)}});function copy_link(a){navigator.clipboard.writeText(a)}
//# sourceMappingURL=view.min.js.map
